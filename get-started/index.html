<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Get Started | The Bin Running Brothers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sign up for bin running service. Quick, simple pricing for North Georgia trash day help.">
    <link rel="stylesheet" href="/css/styles.css">

    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/web-app-manifest-192x192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
</head>
<body>
<div class="page-shell">
    <header class="nav">
        <div class="nav-inner">
            <div class="nav-left">
                <div class="nav-logo-wrap">
                    <img src="/images/TBRB.png" alt="The Bin Running Brothers logo" class="nav-logo">
                </div>
                <div class="nav-title-block">
                    <span class="nav-brand">The Bin Running Brothers</span>
                    <span class="nav-tagline">North Georgia trash day, handled.</span>
                </div>
            </div>
            <nav class="nav-links" aria-label="Primary">
                <a href="/" class="nav-link">Home</a>
                <a href="/services/" class="nav-link">Services</a>
                <a href="/pricing/" class="nav-link">Pricing</a>
                <a href="/process/" class="nav-link">How it works</a>
                <a href="/areas/" class="nav-link">Service areas</a>
                <a href="/contact/" class="nav-link">Contact</a>
            </nav>
            <a class="nav-cta" href="/get-started/">
                <span>Get Started</span>
            </a>
            <button class="nav-menu-toggle" type="button" aria-label="Toggle navigation">
                <div class="nav-menu-toggle-bars">
                    <span></span><span></span><span></span>
                </div>
            </button>
        </div>
        <div class="nav-links-mobile">
            <div class="nav-links-mobile-inner">
                <a href="/">Home</a>
                <a href="/services/">Services</a>
                <a href="/pricing/">Pricing</a>
                <a href="/process/">How it works</a>
                <a href="/areas/">Service areas</a>
                <a href="/contact/">Contact</a>
            </div>
        </div>
    </header>

    <main style="flex: 1; background: #f7f7f7; padding: 40px 0;">
        <section class="section">
            <div class="wizard-container">
                
                <div class="wizard-progress" aria-hidden="true">
                    <div class="wizard-step-indicator active" id="indicator-1">
                        <div class="step-circle">1</div>
                        <span class="step-label">Contact</span>
                    </div>
                    <div class="wizard-step-indicator" id="indicator-2">
                        <div class="step-circle">2</div>
                        <span class="step-label">Address</span>
                    </div>
                    <div class="wizard-step-indicator" id="indicator-3">
                        <div class="step-circle">3</div>
                        <span class="step-label">Service</span>
                    </div>
                </div>

                <form id="signup-form" novalidate>
    
                    <div class="wizard-step active" id="step-1" role="tabpanel">
                        <h1 class="wizard-title">Letâ€™s get started</h1>
                        <p class="wizard-subtitle">First, who are we helping?</p>
                
                        <div class="grid-2" style="gap: 16px;">
                            <div class="form-group">
                                <label class="form-label" for="firstName">First Name</label>
                                <input type="text" class="form-input" id="firstName" name="firstName" required autocomplete="given-name">
                                <div class="error-msg">Please enter your first name.</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="lastName">Last Name</label>
                                <input type="text" class="form-input" id="lastName" name="lastName" required autocomplete="family-name">
                                <div class="error-msg">Please enter your last name.</div>
                            </div>
                        </div>
                
                        <div class="form-group">
                            <label class="form-label" for="email">Email Address</label>
                            <input type="email" class="form-input" id="email" name="email" required autocomplete="email">
                            <div class="error-msg">Please enter a valid email address.</div>
                        </div>
                
                        <div class="form-group">
                            <label class="form-label" for="phone">Phone Number</label>
                            <input type="tel" class="form-input" id="phone" name="phone" required autocomplete="tel" placeholder="(555) 555-5555" maxlength="14">
                            <div class="error-msg">Please enter a valid phone number.</div>
                        </div>
                
                        <div class="wizard-actions">
                            <button type="button" class="btn-back" disabled style="opacity:0; pointer-events:none;">Back</button>
                            <button type="button" class="btn-primary next-step">
                                <span>Next: Address</span>
                                <span class="btn-icon-circle">â†’</span>
                            </button>
                        </div>
                    </div>
                
                    <div class="wizard-step" id="step-2" role="tabpanel">
                        <h2 class="wizard-title">Where do you need service?</h2>
                        <p class="wizard-subtitle">We currently serve Jasper, Ball Ground, and Canton.</p>
                
                        <div class="form-group">
                            <label class="form-label" for="street">Street Address</label>
                            <input type="text" class="form-input" id="street" name="street" required autocomplete="off" placeholder="Start typing your address...">
                            <div class="error-msg">Please enter your street address.</div>
                        </div>
                
                        <div class="grid-2" style="gap: 16px;">
                            <div class="form-group">
                                <label class="form-label" for="city">City</label>
                                <input type="text" class="form-input" id="city" name="city" required autocomplete="address-level2">
                                <div class="error-msg">Please enter your city.</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="zip">Zip Code</label>
                                <input type="text" class="form-input" id="zip" name="zip" required autocomplete="postal-code" inputmode="numeric">
                                <div class="error-msg">Please enter a valid zip code.</div>
                            </div>
                        </div>
                
                        <div class="form-group">
                            <label class="form-label" for="gateCode">Gate Code / Access Instructions (Optional)</label>
                            <textarea class="form-textarea" id="gateCode" name="gateCode" rows="2" placeholder="e.g. Gate code is #1234, or steep driveway."></textarea>
                        </div>
                
                        <div class="wizard-actions">
                            <button type="button" class="btn-back prev-step">Back</button>
                            <button type="button" class="btn-primary next-step">
                                <span>Next: Service Details</span>
                                <span class="btn-icon-circle">â†’</span>
                            </button>
                        </div>
                    </div>
                
                    <div id="step-3" class="wizard-step" style="display: none;">
                        <div class="step-header">
                            <h2 class="text-2xl font-bold mb-2">Customize your plan</h2>
                            <p class="text-gray-600 mb-6">Almost done. Tell us about your trash day.</p>
                        </div>
                    
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">How often do you need help?</label>
                                <select name="frequency" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all" required>
                                    <option value="weekly">Weekly Service (Best Value)</option>
                                    <option value="biweekly">Bi-Weekly Service</option>
                                    <option value="monthly">Monthly Service</option>
                                    <option value="vacation">One-Time / Vacation Service</option>
                                </select>
                            </div>
                    
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Trash Pickup Day</label>
                                    <select name="pickupDay" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none" required>
                                        <option value="" disabled selected>Select Day</option>
                                        <option value="Monday">Monday</option>
                                        <option value="Tuesday">Tuesday</option>
                                        <option value="Wednesday">Wednesday</option>
                                        <option value="Thursday">Thursday</option>
                                        <option value="Friday">Friday</option>
                                    </select>
                                </div>
                    
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Number of Bins</label>
                                    <select name="binCount" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none">
                                        <option value="1">1 Bin</option>
                                        <option value="2">2 Bins</option>
                                        <option value="3">3 Bins</option>
                                        <option value="4">4 Bins</option>
                                    </select>
                                </div>
                            </div>
                    
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Trash Provider (Optional)</label>
                                <input type="text" name="hauler" placeholder="e.g. Waste Management, Republic, etc." 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none">
                            </div>
                    
                            <div class="space-y-3 pt-2">
                                <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="cleaning" class="w-5 h-5 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                    <span class="ml-3 text-sm text-gray-700">Include bin cleaning info?</span>
                                </label>
                    
                                <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                    <input type="checkbox" name="recyclingReminders" class="w-5 h-5 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                    <span class="ml-3 text-sm text-gray-700">Enable recycling day SMS reminders?</span>
                                </label>
                            </div>
                        </div>
                    
                        <div class="flex justify-between mt-8 pt-4 border-t border-gray-100">
                            <button type="button" class="text-gray-500 hover:text-gray-800 font-medium px-4 py-2" onclick="prevStep(3)">Back</button>
                            <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <span id="submit-text">Complete Request</span>
                            </button>
                        </div>
                    </div>
                
                    <div class="wizard-step" id="step-success" role="tabpanel" style="text-align: center;">
                        <span class="success-icon" style="font-size: 60px; display:block; margin-bottom: 20px;">ðŸŽ‰</span>
                        <h2 class="wizard-title">Weâ€™ve got it!</h2>
                        <p class="wizard-subtitle">Thanks <span id="success-name"></span>. We have received your details.</p>
                        
                        <div style="background: #f0fdf4; border: 1px solid #dcfce7; color: #166534; padding: 20px; border-radius: 12px; margin-bottom: 30px; text-align: left;">
                            <strong style="display:block; margin-bottom: 8px;">What happens next?</strong>
                            We will text you at <strong id="success-phone"></strong> within 24 hours to confirm your route availability and final price.
                        </div>
                
                        <a href="/" class="btn-secondary">Return Home</a>
                    </div>
                
                </form>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-inner">
            <div>
                <div class="footer-brand-row">
                    <div class="nav-logo-wrap">
                        <img src="/images/TBRB.png" alt="The Bin Running Brothers logo small">
                    </div>
                    <span class="nav-brand">The Bin Running Brothers</span>
                </div>
                <div class="footer-nav">
                    <a href="/" class="footer-link">Home</a>
                    <a href="/services/" class="footer-link">Services</a>
                    <a href="/pricing/" class="footer-link">Pricing</a>
                    <a href="/process/" class="footer-link">How it works</a>
                    <a href="/areas/" class="footer-link">Service areas</a>
                    <a href="/contact/" class="footer-link">Contact</a>
                </div>
                <div class="footer-meta">
                    Serving North Georgia.<br>
                    Â© <span id="footer-year"></span> The Bin Running Brothers. All rights reserved.
                </div>
            </div>
        </div>
    </footer>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmED6YgmsNT8cE2-0k6qVBhcRS1R85vv4&libraries=places&callback=initGoogleAutocomplete" async defer></script>
<script src="/js/main.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const signupForm = document.getElementById('signup-form');
        const submitBtn = signupForm.querySelector('button[type="submit"]');
        const submitText = document.getElementById('submit-text');
    
        // --- CONFIGURATION ---
        const CONFIG = {
            API_URL: "https://bcbpro.com/api/v1/leads/ingest",
            
            // This MUST match the key inside backend/app/api/public_leads.py
            API_KEY: "bcb-secret-ingest-key-change-this", 
            
            // This MUST match the slug in your 'business_accounts' table
            BUSINESS_SLUG: "tbrb", 
            
            // MAPPED UUIDS FROM YOUR DATABASE OUTPUT
            PLANS: {
                // "Weekly Service" -> Valet Trash (Weekly)
                'weekly':   '68d8f46b-ed33-49d8-b3f2-3a195ff07fa3', 
    
                // "Every Other Week" -> Valet Trash (Bi-Weekly)
                'biweekly': 'ca836d6f-cf78-41f4-93bf-cb3f98ad0fd8', 
    
                // "Monthly" -> Valet Trash (Monthly)
                'monthly':  '26c7c98f-86ad-495e-b4eb-6be6ace936f3', 
    
                // "Vacation / One-time" -> One-Time Valet
                'vacation': '2d89e515-6d52-4050-8b1f-85730c74d06c'  
            }
        };
    
        signupForm.addEventListener('submit', async function(e) {
            e.preventDefault();
    
            // 1. UI Loading State
            const originalText = submitText.innerText;
            submitBtn.disabled = true;
            submitText.innerText = "Processing...";
            submitBtn.style.opacity = "0.7";
    
            // 2. Gather Data
            const formData = new FormData(signupForm);
            
            const notes = [
                `Gate/Access: ${formData.get('gateCode') || 'N/A'}`,
                `Trash Day: ${formData.get('pickupDay')}`,
                `Current Hauler: ${formData.get('hauler') || 'N/A'}`,
                `Recycling Reminders: ${formData.get('recyclingReminders') ? 'Yes' : 'No'}`,
                `Cleaning Interest: ${formData.get('cleaning') ? 'Yes' : 'No'}`
            ].join('\n');
    
            // Select Plan ID
            const selectedFreq = formData.get('frequency');
            // Default to Weekly if selection is missing
            const planId = CONFIG.PLANS[selectedFreq] || CONFIG.PLANS['weekly'];
    
            // 3. Build Payload
            const payload = {
                business_slug: CONFIG.BUSINESS_SLUG,
                service_plan_id: planId,
                
                first_name: formData.get('firstName'),
                last_name: formData.get('lastName'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                
                street_address: formData.get('street'),
                city: formData.get('city'),
                state: "GA",
                zip_code: formData.get('zip'),
                
                bin_count: parseInt(formData.get('binCount'), 10) || 1,
                notes: notes
            };
    
            try {
                console.log("Submitting to BCBConnect:", payload);
    
                const response = await fetch(CONFIG.API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-BCB-INGEST-KEY": CONFIG.API_KEY
                    },
                    body: JSON.stringify(payload)
                });
    
                const result = await response.json();
    
                if (response.ok && result.status === "success") {
                    if (result.checkout_url) {
                        // SUCCESS: Redirect to Stripe
                        submitText.innerText = "Redirecting to Payment...";
                        window.location.href = result.checkout_url;
                    } else {
                        // Fallback success (no payment link generated)
                        showSuccessStep(payload.first_name, payload.phone);
                    }
                } else if (result.status === "exists") {
                    alert("It looks like you already have an account! Please log in at bcbpro.com.");
                    submitBtn.disabled = false;
                    submitText.innerText = originalText;
                } else {
                    console.error("Submission Error:", result);
                    alert("Something went wrong. Please try again.");
                    submitBtn.disabled = false;
                    submitText.innerText = originalText;
                }
    
            } catch (error) {
                console.error("Network Error:", error);
                alert("Unable to connect to the server. Please check your connection.");
                submitBtn.disabled = false;
                submitText.innerText = originalText;
            }
        });
    
        function showSuccessStep(name, phone) {
            document.querySelectorAll('.wizard-step').forEach(el => el.style.display = 'none');
            document.getElementById('step-success').style.display = 'block';
            document.getElementById('success-name').innerText = name;
            document.getElementById('success-phone').innerText = phone;
        }
    });
    </script>
</body>
</html>